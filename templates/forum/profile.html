<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile</title>
    {% load static %}
    <script src="{% static 'forum/js/script.js' %}"></script>
    <link rel="stylesheet" href="{% static 'forum/css/style.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
</head>

<body>
    {% if user.is_authenticated %}
    <div id="menu-wrapper"></div>
    <div id="menu-container">
        <button type="button" class="menu"></button>
        <div class="box">
            <div class="box-inner">
                <ul style="list-style-type:none">
                    <li><a href="/forum" method="POST" class="menu-btn">Home</a></li>
                    <li><a href="/forum/user/{{request.user.id}}" class="menu-btn">Profile</a></li>
                </ul>


            </div>
        </div>
    </div>
    <h2>Hello, {{ request.user }}</h2>
    <a href="/forum" method="POST" class="btn-1">Home</a>
    <a href="/forum/user/{{request.user.id}}" class="btn-1">Profile</a>
    <a href="/logout_user" method="POST" class="btn-1">Logout</a>
    <div id="main">


        <h1>{{ user.first_name }}'s Post History</h1>
        <br>
        <table class="profile-table">
            {% for s in posts reversed %}
            <tr class="shadowed-tr">
                <th>Item</th>

                <th>Added By</th>
                <th>Comments</th>
                <th>Likes</th>
                <th></th>

            </tr>


            <tr class="shadowed-tr">
                <td class="left"><span class="title-link"><a href="/forum/details/{{ s.id }}"
                            class="title-link">{{ s.title }}</a></span><span class="created_at">Added on
                        {{ s.created_at }}</span>
                </td>

                <td class="center"><a href="/forum/user/{{s.post_author.id}}"
                        class="home-link-authors">{{ s.post_author.first_name }}</a></td>
                <td class="center">{{ s.comments.count }}</td>
                <td class="center"><span class="likes">{{ s.liked_members.count }}</span></td>
                <td class="right"> <a href="/forum/details/{{ s.id }}" class="btn-1">View</a>
                </td>

            </tr>
            <tr>
                <td colspan="6" style="padding: 0; background: transparent;">

                    <div id="review-content">
                        <br><br>
                        {{ s.body|safe }}
                    </div>
                    <div class="comment_controls">
                        <div id="CommentsToggle" class="comment_divs">
                            <button class="CslideDown">
                                {% if s.comments.count > 0 %}



                                View {{ s.comments.count }} Comments
                                {% else %}
                                Be the first to comment


                                {% endif %}



                            </button>
                            <div class="CommentsSlideDownHidden">

                                <table class="profile-comments-table">

                                    <tr>
                                        <th> </th>



                                    </tr>
                                    {% for c in comments reversed %}
                                    {% if s.id == c.post_id %}
                                    <tr>
                                        <td>
                                            <div class="by"><a href="/forum/user/{{c.comment_author.id}}"
                                                    class="profile-link-comments">{{ c.comment_author.first_name }}</a>
                                                |
                                                <span class="dt">{{ c.created_at }}</span></div>
                                            <div id="text">{{ c.comment }}
                                            </div><br>

                                            <div id="comment-control">{% if request.user.id == c.comment_author.id %}
                                                <a href="/forum/delete_profile_comment/{{ c.id }}/{{ s.post_author.id }}"
                                                    class="btn-1 s-delete">Delete</a>{% endif %}

                                            </div>

                                        </td>



                                    </tr>


                                    {% endif %}
                                    {% endfor %}
                                    <td>
                                        <div id="comments">
                                            <div class="comment-box">
                                                <h3>Comment on {{ s.title }}:</h1>


                                                    <form
                                                        action="/forum/add_profile_comment/{{ s.id }}/{{ s.post_author.id }}"
                                                        method="POST">
                                                        {% csrf_token %}
                                                        <textarea rows="4" cols="50" name="comment" required></textarea>
                                                        <br>
                                                        <input type="submit" value="Add Comment" class="btn-1 green">

                                                    </form>
                                            </div>
                                        </div>
                                    </td>
                                </table>

                            </div>
                        </div>
                    </div>






                </td>
            </tr>

            {% endfor %}
        </table>


    </div>
    {% else %}
    <div id="login-box">
        <div id="login-inner">
            <span class="please-login">
                You need to be logged in to see this page.
                <a href="/"><span class="btn-1">Login</span></a></span>
        </div>
    </div>
    {% endif %}
    <script>
        $(document).ready(function () {
            $('#main').fadeIn('slow');
        });
    </script>
    <script>
        $(document).ready(function () {
            $('button.slideDown').click(function () {
                if ($(this).siblings('.slideDownHidden').is(':hidden')) {
                    $(this).siblings('.slideDownHidden').slideDown('fast');
                } else {
                    $(this).siblings('.slideDownHidden').slideUp('fast');
                }
            });
            $('button.CslideDown').click(function () {
                if ($(this).siblings('.CommentsSlideDownHidden').is(':hidden')) {
                    $(this).siblings('.CommentsSlideDownHidden').fadeIn().slideDown("fast");
                } else {
                    $(this).siblings('.CommentsSlideDownHidden').slideUp('fast');
                }
            });
            $(".menu").click(function () {
                $(".box").animate({
                    width: "toggle"
                });
            });
            $('.menu').click(function () {
                $('#menu-wrapper').fadeToggle('slow');
            });

        });
    </script>
    <!-- <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>tinymce.init({ selector: 'textarea', menubar: 'false', plugins: 'quickbars', });</script> -->
</body>

</html>